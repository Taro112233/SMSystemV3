// prisma/schemas/audit.prisma
// ===== PRODUCTION-READY AUDIT SYSTEM - InvenStock V2.0 =====

model AuditLog {
  id             String        @id @default(cuid())
  organizationId String
  
  // Actor & Target
  userId         String?       // ผู้ทำ action
  targetUserId   String?       // ผู้ถูกกระทำ (optional)
  
  // Department Context
  departmentId   String?       // หน่วยงานที่เกี่ยวข้อง
  
  // Action Classification
  action         String        // "products.create"
  category       AuditCategory // PRODUCT, STOCK, TRANSFER, USER, ORG
  severity       AuditSeverity @default(INFO)
  
  // Human-Readable
  description    String        // "สมชาย สร้างสินค้า Paracetamol ที่คลังยา"
  
  // Resource Tracking
  resourceId     String?       // ID ของ record
  resourceType   String?       // "Product", "Stock", "Transfer"
  
  // Detailed Data
  payload        Json?         // { before, after, metadata }
  
  // Request Context
  ipAddress      String?
  userAgent      String?       // Browser/device info
  
  // Timestamp
  createdAt      DateTime @default(now())
  
  // Relations
  organization   Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  user           User? @relation("AuditLogUser", fields: [userId], references: [id], onDelete: SetNull)
  targetUser     User? @relation("AuditLogTarget", fields: [targetUserId], references: [id], onDelete: SetNull)
  department     Department? @relation(fields: [departmentId], references: [id], onDelete: SetNull)
  
  // Optimized Indexes
  @@index([organizationId, createdAt(sort: Desc)])
  @@index([departmentId, createdAt(sort: Desc)])
  @@index([userId, createdAt(sort: Desc)])
  @@index([action])
  @@index([category, severity])
  @@index([resourceId])
  @@map("audit_logs")
}

// Enums
enum AuditCategory {
  PRODUCT       // สินค้า
  STOCK         // สต็อก
  TRANSFER      // การโอนย้าย
  USER          // ผู้ใช้
  ORGANIZATION  // องค์กร
  DEPARTMENT    // หน่วยงาน
  AUTH          // Authentication
  SYSTEM        // ระบบ
}

enum AuditSeverity {
  INFO          // ปกติ (90%)
  WARNING       // สำคัญ (8%)
  CRITICAL      // วิกฤติ (2%)
}