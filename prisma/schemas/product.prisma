// prisma/schemas/product.prisma
// ===== PRODUCT MANAGEMENT SCHEMA - InvenStock V1.0 =====

// Custom Product Categories per Organization
model ProductCategory {
  id             String       @id @default(cuid())
  organizationId String
  parentId       String?      // For hierarchical structure
  
  // Category Details
  name           String
  code           String?      // Category code
  description    String?
  color          ColorTheme?    // แทน String?
  icon           IconType?      // แทน String?
  
  // Settings
  isActive       Boolean      @default(true)
  sortOrder      Int          @default(0)
  
  // Timestamps
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt
  
  // Relations
  organization   Organization    @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  parent         ProductCategory? @relation("CategoryHierarchy", fields: [parentId], references: [id])
  children       ProductCategory[] @relation("CategoryHierarchy")
  products       Product[]
  
  @@unique([organizationId, name])
  @@index([parentId])
  @@index([sortOrder])
  @@map("product_categories")
}

// Custom Product Types per Organization
model ProductType {
  id             String       @id @default(cuid())
  organizationId String
  
  // Type Details
  name           String       // เช่น "ยาเม็ด", "ยาน้ำ", "อุปกรณ์การแพทย์"
  code           String?      // รหัสประเภท
  description    String?
  color          ColorTheme?    // แทน String?
  icon           IconType?      // แทน String?
  
  // Settings
  isActive       Boolean      @default(true)
  sortOrder      Int          @default(0)
  
  // Timestamps
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt
  
  // Relations
  organization   Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  products       Product[]
  
  @@unique([organizationId, name])
  @@index([isActive])
  @@map("product_types")
}

// Custom Product Forms per Organization  
model ProductForm {
  id             String       @id @default(cuid())
  organizationId String
  
  // Form Details
  name           String       // เช่น "เม็ด", "แคปซูล", "น้ำ", "ครีม"
  code           String?      // รหัสรูปแบบ
  description    String?
  
  // Settings
  isActive       Boolean      @default(true)
  sortOrder      Int          @default(0)
  
  // Timestamps
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt
  
  // Relations
  organization   Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  products       Product[]
  
  @@unique([organizationId, name])
  @@index([isActive])
  @@map("product_forms")
}

// Products with Custom Organization Fields
model Product {
  id             String          @id @default(cuid())
  organizationId String
  categoryId     String?         // หมวดหมู่สินค้า
  typeId         String?         // ประเภทสินค้า (custom per org)
  formId         String?         // รูปแบบสินค้า (custom per org)
  
  // Product Identification - ตามความต้องการ
  orgProductCode String          // รหัสสินค้าขององค์กร (required)
  barcode        String?         // Barcode/QR code
  
  // Product Details - ตามความต้องการ
  name           String          // ชื่อสินค้า (required)
  description    String?         // รายละเอียดสินค้า (optional)
  supplier       String?         // ชื่อผู้จัดจำหน่าย (optional)
  
  // Product Specifications - ตามความต้องการ
  strength       String?         // ความแรงสินค้า (เช่น "500mg")
  volume         String?         // ปริมาตรสินค้า (เช่น "100ml")
  qtyPerBox      Int             @default(1) // ปริมาณต่อกล่อง (required, default 1)
  unit           UnitType        @default(PIECE)
  
  // Inventory Settings
  minStockLevel  Int             @default(0)     // Minimum stock alert
  maxStockLevel  Int?            // Maximum stock limit
  
  // Status & Settings - ตามความต้องการ
  isActive       Boolean         @default(true)  // สถานะการใช้งาน (required)
  
  // Audit Fields
  createdBy      String          // User who created
  updatedBy      String?         // User who last updated
  
  // Timestamps
  createdAt      DateTime        @default(now())
  updatedAt      DateTime        @updatedAt
  
  // Relations
  organization   Organization    @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  category       ProductCategory? @relation(fields: [categoryId], references: [id])
  productType    ProductType?    @relation(fields: [typeId], references: [id])
  productForm    ProductForm?    @relation(fields: [formId], references: [id])
  batches        ProductBatch[]
  stocks         Stock[]
  transferItems  TransferItem[]
  
  @@unique([organizationId, orgProductCode]) // องค์กรต้องมีรหัสสินค้าไม่ซ้ำ
  @@index([isActive])
  @@index([categoryId])
  @@index([typeId])
  @@index([formId])
  @@index([barcode])
  @@map("products")
}

// Product Batches for Lot/Expiry/Price Tracking - ตามความต้องการ
model ProductBatch {
  id             String       @id @default(cuid())
  productId      String
  
  // Batch Details - ตามความต้องการ
  batchNumber    String       // Lot/Batch number (required)
  expiryDate     DateTime?    // วันหมดอายุ (optional)
  
  // Pricing - ตามความต้องการ (แต่ละ lot ราคาต่างกัน)
  costPrice      Float        @default(0) // ราคาต้นทุนต่อกล่อง (required)
  sellingPrice   Float        @default(0) // ราคาขายต่อกล่อง (required)
  
  // Quantity Tracking
  currentQty     Int          @default(0) // จำนวนปัจจุบัน
  
  // Status
  isActive       Boolean      @default(true)
  
  // Audit Fields
  createdBy      String       // User who created
  updatedBy      String?      // User who last updated
  
  // Timestamps
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt
  
  // Relations
  product        Product      @relation(fields: [productId], references: [id], onDelete: Cascade)
  stockTransactions StockTransaction[]
  transferItems  TransferItem[]
  
  @@unique([productId, batchNumber]) // สินค้าแต่ละตัวต้องมี batch number ไม่ซ้ำ
  @@index([expiryDate])
  @@index([isActive])
  @@index([costPrice])
  @@map("product_batches")
}