// prisma/schemas/organization.prisma
// ===== SIMPLIFIED ORGANIZATION SCHEMA WITH INVITE CODE ONLY =====

model Organization {
  id          String             @id @default(cuid())
  name        String
  slug        String             @unique // URL-friendly identifier
  description String?
  
  // Contact Information
  email       String?
  phone       String?
  
  // Settings
  status      OrganizationStatus @default(ACTIVE)
  timezone    String             @default("Asia/Bangkok")
  
  // Invite Code System Only
  inviteCode     String?    @unique // Organization-generated invite code
  inviteEnabled  Boolean    @default(true) // Allow joining via invite code
  
  // Timestamps
  createdAt   DateTime           @default(now())
  updatedAt   DateTime           @updatedAt
  
  // Relations
  users       OrganizationUser[]
  departments Department[]
  auditLogs   AuditLog[]
  
  @@index([slug])
  @@index([status])
  @@index([inviteCode])
  @@map("organizations")
}

// User-Organization Relationship (Many-to-Many)
model OrganizationUser {
  id             String       @id @default(cuid())
  organizationId String
  userId         String
  
  // Role & Membership
  roles          OrganizationRole @default(MEMBER)
  isOwner        Boolean      @default(false)
  joinedAt       DateTime     @default(now())
  lastActiveAt   DateTime?
  
  // Status
  isActive       Boolean      @default(true)
  
  // Relations
  organization   Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  user           User         @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  @@unique([organizationId, userId])
  @@index([isActive])
  @@index([roles])
  @@map("organization_users")
}

// Simplified Departments (Data Organization Only)
model Department {
  id             String       @id @default(cuid())
  organizationId String
  parentId       String?      // For hierarchical structure (optional)
  
  // Department Details
  name           String
  slug           String       // Short slug (e.g., "ICU", "OPD", "PHARMACY")
  description    String?
  color          ColorTheme?
  icon           IconType?
  
  // Simple Status
  isActive       Boolean      @default(true)
  
  // Audit Fields (for tracking who created/modified)
  createdBy      String       // User who created
  updatedBy      String?      // User who last updated
  
  // Timestamps
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt
  
  // Relations
  organization   Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  parent         Department?  @relation("DepartmentHierarchy", fields: [parentId], references: [id])
  children       Department[] @relation("DepartmentHierarchy")
  
  // âœ… FIXED: Audit Log Relation
  auditLogs      AuditLog[]
  
  @@unique([organizationId, slug])
  @@index([parentId])
  @@index([isActive])
  @@map("departments")
}