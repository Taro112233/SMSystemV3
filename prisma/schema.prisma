// This file is auto-generated. Do not edit manually.
// Edit files in prisma/schemas/ directory instead.
// Last generated: 2025-10-12T18:34:47.348Z
// InvenStock - Multi-Tenant Inventory Management System V1.0

generator client {
  provider = "prisma-client-js"
  previewFeatures = ["multiSchema", "relationJoins"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
  directUrl = env("DIRECT_URL") // For connection pooling
}


// ==========================================
// BASE SCHEMA - V1.0
// ==========================================

// prisma/schemas/base.prisma
// ===== MINIMAL CORE ENUMS - Invite Code Only System =====

// ===== USER & ORGANIZATION ENUMS =====
enum UserStatus {
  PENDING    // ‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô email
  ACTIVE     // ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ
  SUSPENDED  // ‡∏£‡∏∞‡∏á‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô
  INACTIVE   // ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô
}

enum OrganizationStatus {
  ACTIVE     // ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ
  SUSPENDED  // ‡∏£‡∏∞‡∏á‡∏±‡∏ö
  TRIAL      // ‡∏ó‡∏î‡∏•‡∏≠‡∏á‡πÉ‡∏ä‡πâ
}

// ===== SIMPLIFIED ROLE SYSTEM =====
enum OrganizationRole {
  MEMBER  // ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ ‡πÄ‡∏ö‡∏¥‡∏Å ‡∏à‡πà‡∏≤‡∏¢ ‡πÅ‡∏Å‡πâ‡∏™‡∏ï‡πá‡∏≠‡∏Å ‡∏î‡∏π‡∏ó‡∏∏‡∏Å‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô
  ADMIN   // Member + CRUD ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤/‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô + ‡πÄ‡∏ä‡∏¥‡∏ç‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ 
  OWNER   // Admin + ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏≠‡∏á‡∏Ñ‡πå‡∏Å‡∏£ + ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏£‡∏∞‡∏ö‡∏ö
}

// ===== UI ENUMS FOR COLORS & ICONS =====
enum ColorTheme {
  BLUE         // #3B82F6 - ‡∏™‡∏µ‡∏ô‡πâ‡∏≥‡πÄ‡∏á‡∏¥‡∏ô
  GREEN        // #10B981 - ‡∏™‡∏µ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß
  RED          // #EF4444 - ‡∏™‡∏µ‡πÅ‡∏î‡∏á
  YELLOW       // #F59E0B - ‡∏™‡∏µ‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏á
  PURPLE       // #8B5CF6 - ‡∏™‡∏µ‡∏°‡πà‡∏ß‡∏á
  PINK         // #EC4899 - ‡∏™‡∏µ‡∏ä‡∏°‡∏û‡∏π
  INDIGO       // #6366F1 - ‡∏™‡∏µ‡∏ô‡πâ‡∏≥‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏Ç‡πâ‡∏°
  TEAL         // #14B8A6 - ‡∏™‡∏µ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß‡∏ü‡πâ‡∏≤
  ORANGE       // #F97316 - ‡∏™‡∏µ‡∏™‡πâ‡∏°
  GRAY         // #6B7280 - ‡∏™‡∏µ‡πÄ‡∏ó‡∏≤
  SLATE        // #475569 - ‡∏™‡∏µ‡πÄ‡∏ó‡∏≤‡πÄ‡∏Ç‡πâ‡∏°
  EMERALD      // #059669 - ‡∏™‡∏µ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß‡∏°‡∏£‡∏Å‡∏ï
}

enum IconType {
  // Department Icons
  BUILDING     // üè¢ ‡∏™‡∏≥‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô
  HOSPITAL     // üè• ‡πÇ‡∏£‡∏á‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•
  PHARMACY     // üíä ‡∏£‡πâ‡∏≤‡∏ô‡∏¢‡∏≤
  WAREHOUSE    // üì¶ ‡∏Ñ‡∏•‡∏±‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤
  LABORATORY   // üß™ ‡∏´‡πâ‡∏≠‡∏á‡πÅ‡∏•‡πá‡∏ö
  
  // Product Category Icons
  PILL         // üíä ‡∏¢‡∏≤‡πÄ‡∏°‡πá‡∏î
  BOTTLE       // üçº ‡∏¢‡∏≤‡∏ô‡πâ‡∏≥
  SYRINGE      // üíâ ‡∏¢‡∏≤‡∏â‡∏µ‡∏î
  BANDAGE      // ü©π ‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏Å‡∏≤‡∏£‡πÅ‡∏û‡∏ó‡∏¢‡πå
  STETHOSCOPE  // ü©∫ ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠‡πÅ‡∏û‡∏ó‡∏¢‡πå
  
  // Role Icons
  CROWN        // üëë ‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á
  SHIELD       // üõ°‡πå ‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£
  PERSON       // üë§ ‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô
  EYE          // üëÅÔ∏è ‡∏ú‡∏π‡πâ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö
  GEAR         // ‚öôÔ∏è ‡∏£‡∏∞‡∏ö‡∏ö
  
  // General Icons
  BOX          // üì¶ ‡∏Å‡∏•‡πà‡∏≠‡∏á
  FOLDER       // üìÅ ‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå
  TAG          // üè∑Ô∏è ‡∏õ‡πâ‡∏≤‡∏¢‡∏Å‡∏≥‡∏Å‡∏±‡∏ö
  STAR         // ‚≠ê ‡∏î‡∏≤‡∏ß
  HEART        // ‚ù§Ô∏è ‡∏´‡∏±‡∏ß‡πÉ‡∏à
  CIRCLE       // ‚ö™ ‡∏ß‡∏á‡∏Å‡∏•‡∏°
  SQUARE       // ‚¨ú ‡∏™‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏µ‡πà‡∏¢‡∏°
  TRIANGLE     // üî∫ ‡∏™‡∏≤‡∏°‡πÄ‡∏´‡∏•‡∏µ‡πà‡∏¢‡∏°
}

// ===== ‚úÖ NEW: USER SNAPSHOT TYPE =====
// ‡πÉ‡∏ä‡πâ‡πÉ‡∏ô Audit Logs ‡πÅ‡∏•‡∏∞ Records ‡∏ï‡πà‡∏≤‡∏á‡πÜ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• user ‡∏ì ‡∏Ç‡∏ì‡∏∞‡∏ô‡∏±‡πâ‡∏ô
// Structure:
// {
//   "userId": "clxxx",
//   "username": "admin01",
//   "fullName": "‡∏™‡∏°‡∏ä‡∏≤‡∏¢ ‡πÉ‡∏à‡∏î‡∏µ",
//   "email": "somchai@hospital.com",
//   "role": "ADMIN" // Role ‡∏ì ‡∏Ç‡∏ì‡∏∞‡∏ô‡∏±‡πâ‡∏ô (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ context)
// }

// ==========================================
// USER SCHEMA - V1.0
// ==========================================

// prisma/schemas/user.prisma
// ===== USER MANAGEMENT SCHEMA - Clean & Simple =====

model User {
  id          String     @id @default(cuid())
  email       String?    // Optional for notifications/recovery
  username    String     @unique  // Primary login credential
  password    String     // bcrypt hashed
  
  // Personal Information
  firstName   String
  lastName    String
  phone       String?
  
  // Account Status
  status      UserStatus @default(PENDING)
  isActive    Boolean    @default(true)
  emailVerified Boolean  @default(false)
  
  // Security
  lastLogin   DateTime?
  
  // Timestamps
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt
  
  // Relations
  organizationUsers   OrganizationUser[]
  auditLogsAsUser     AuditLog[] @relation("AuditLogUser")
  auditLogsAsTarget   AuditLog[] @relation("AuditLogTarget")
  
  @@index([email])
  @@index([username])
  @@index([status])
  @@index([isActive])
  @@map("users")
}

// ==========================================
// ORGANIZATION SCHEMA - V1.0
// ==========================================

// prisma/schemas/organization.prisma
// ===== ORGANIZATION SCHEMA WITH USER SNAPSHOTS =====

model Organization {
  id          String             @id @default(cuid())
  name        String
  slug        String             @unique
  description String?
  
  // Contact Information
  email       String?
  phone       String?
  
  // Visual Customization
  color       ColorTheme?        @default(BLUE)
  icon        IconType?          @default(BUILDING)
  
  // Settings
  status      OrganizationStatus @default(ACTIVE)
  timezone    String             @default("Asia/Bangkok")
  
  // Invite Code System
  inviteCode     String?    @unique
  inviteEnabled  Boolean    @default(true)
  
  // Timestamps
  createdAt   DateTime           @default(now())
  updatedAt   DateTime           @updatedAt
  
  // Relations
  users       OrganizationUser[]
  departments Department[]
  auditLogs   AuditLog[]
  
  @@index([slug])
  @@index([status])
  @@index([inviteCode])
  @@map("organizations")
}

// User-Organization Relationship
model OrganizationUser {
  id             String       @id @default(cuid())
  organizationId String
  userId         String
  
  // Role & Membership
  roles          OrganizationRole @default(MEMBER)
  isOwner        Boolean      @default(false)
  joinedAt       DateTime     @default(now())
  lastActiveAt   DateTime?
  
  // Status
  isActive       Boolean      @default(true)
  
  // Relations
  organization   Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  user           User         @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  @@unique([organizationId, userId])
  @@index([isActive])
  @@index([roles])
  @@map("organization_users")
}

// ‚úÖ UPDATED: Department with User Snapshots
model Department {
  id             String       @id @default(cuid())
  organizationId String
  parentId       String?
  
  // Department Details
  name           String
  slug           String
  description    String?
  color          ColorTheme?
  icon           IconType?
  
  // Status
  isActive       Boolean      @default(true)
  
  // ‚úÖ NEW: Created By - Snapshot + Relation
  createdBy      String       // User ID
  createdBySnapshot Json?     // ‚úÖ NEW: Creator info ‡∏ì ‡∏Ç‡∏ì‡∏∞‡∏ô‡∏±‡πâ‡∏ô
  // Example: { userId, username, fullName, email, role }
  
  // ‚úÖ NEW: Updated By - Snapshot + Relation
  updatedBy      String?      // Last updater ID
  updatedBySnapshot Json?     // ‚úÖ NEW: Last updater info ‡∏ì ‡∏Ç‡∏ì‡∏∞‡∏ô‡∏±‡πâ‡∏ô
  
  // Timestamps
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt
  
  // Relations
  organization   Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  parent         Department?  @relation("DepartmentHierarchy", fields: [parentId], references: [id])
  children       Department[] @relation("DepartmentHierarchy")
  auditLogs      AuditLog[]
  
  @@unique([organizationId, slug])
  @@index([parentId])
  @@index([isActive])
  @@map("departments")
}

// ==========================================
// AUDIT SCHEMA - V1.0
// ==========================================

// prisma/schemas/audit.prisma
// ===== PRODUCTION-READY AUDIT SYSTEM WITH USER SNAPSHOTS =====

model AuditLog {
  id             String        @id @default(cuid())
  organizationId String?       // ‚úÖ FIXED: Made optional for user-level actions
  
  // ‚úÖ Actor (‡∏ú‡∏π‡πâ‡∏ó‡∏≥) - Snapshot + Optional Relation
  userId         String?       // User ID (for relation/query)
  userSnapshot   Json?         // ‚úÖ User info ‡∏ì ‡∏Ç‡∏ì‡∏∞‡∏ô‡∏±‡πâ‡∏ô
  
  // ‚úÖ Target (‡∏ú‡∏π‡πâ‡∏ñ‡∏π‡∏Å‡∏Å‡∏£‡∏∞‡∏ó‡∏≥) - Snapshot + Optional Relation
  targetUserId   String?       // Target User ID
  targetSnapshot Json?         // ‚úÖ Target user info ‡∏ì ‡∏Ç‡∏ì‡∏∞‡∏ô‡∏±‡πâ‡∏ô
  
  // Department Context
  departmentId   String?
  
  // Action Classification
  action         String        // "products.create", "user.profile_updated"
  category       AuditCategory // PRODUCT, STOCK, TRANSFER, USER, ORG
  severity       AuditSeverity @default(INFO)
  
  // Human-Readable Description
  description    String        // "‡∏™‡∏°‡∏ä‡∏≤‡∏¢ ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ Paracetamol ‡∏ó‡∏µ‡πà‡∏Ñ‡∏•‡∏±‡∏á‡∏¢‡∏≤"
  
  // Resource Tracking
  resourceId     String?       // ID ‡∏Ç‡∏≠‡∏á record
  resourceType   String?       // "Product", "Stock", "Transfer", "User"
  
  // Detailed Data (before/after comparison)
  payload        Json?         // { before, after, metadata }
  
  // Request Context
  ipAddress      String?
  userAgent      String?
  
  // Timestamp
  createdAt      DateTime @default(now())
  
  // ‚úÖ Relations (‡∏¢‡∏±‡∏á‡∏Ñ‡∏á‡πÑ‡∏ß‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö query/join) - Made optional
  organization   Organization? @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  user           User? @relation("AuditLogUser", fields: [userId], references: [id], onDelete: SetNull)
  targetUser     User? @relation("AuditLogTarget", fields: [targetUserId], references: [id], onDelete: SetNull)
  department     Department? @relation(fields: [departmentId], references: [id], onDelete: SetNull)
  
  // Optimized Indexes
  @@index([organizationId, createdAt(sort: Desc)])
  @@index([departmentId, createdAt(sort: Desc)])
  @@index([userId, createdAt(sort: Desc)])
  @@index([action])
  @@index([category, severity])
  @@index([resourceId])
  @@map("audit_logs")
}

// Enums (‡πÑ‡∏°‡πà‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á)
enum AuditCategory {
  PRODUCT       // ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤
  STOCK         // ‡∏™‡∏ï‡πá‡∏≠‡∏Å
  TRANSFER      // ‡∏Å‡∏≤‡∏£‡πÇ‡∏≠‡∏ô‡∏¢‡πâ‡∏≤‡∏¢
  USER          // ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ
  ORGANIZATION  // ‡∏≠‡∏á‡∏Ñ‡πå‡∏Å‡∏£
  DEPARTMENT    // ‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô
  AUTH          // Authentication
  SYSTEM        // ‡∏£‡∏∞‡∏ö‡∏ö
}

enum AuditSeverity {
  INFO          // ‡∏õ‡∏Å‡∏ï‡∏¥ (90%)
  WARNING       // ‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç (8%)
  CRITICAL      // ‡∏ß‡∏¥‡∏Å‡∏§‡∏ï‡∏¥ (2%)
}
