// This file is auto-generated. Do not edit manually.
// Edit files in prisma/schemas/ directory instead.
// Last generated: 2025-09-09T14:36:47.154Z
// InvenStock - Multi-Tenant Inventory Management System V1.0

generator client {
  provider = "prisma-client-js"
  previewFeatures = ["multiSchema", "relationJoins"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
  directUrl = env("DIRECT_URL") // For connection pooling
}


// ==========================================
// BASE SCHEMA - V1.0
// ==========================================

// prisma/schemas/base.prisma
// ===== CORE ENUMS & BASE TYPES - InvenStock V1.0 =====

// ===== USER & ORGANIZATION ENUMS =====
enum UserStatus {
  PENDING    // à¸£à¸­à¸à¸²à¸£à¸¢à¸·à¸™à¸¢à¸±à¸™ email
  ACTIVE     // à¹ƒà¸Šà¹‰à¸‡à¸²à¸™à¹„à¸”à¹‰
  SUSPENDED  // à¸£à¸°à¸‡à¸±à¸šà¸à¸²à¸£à¹ƒà¸Šà¹‰à¸‡à¸²à¸™
  INACTIVE   // à¹„à¸¡à¹ˆà¹ƒà¸Šà¹‰à¸‡à¸²à¸™
}

enum InvitationStatus {
  PENDING    // à¸£à¸­à¸•à¸­à¸šà¸£à¸±à¸š
  ACCEPTED   // à¸•à¸­à¸šà¸£à¸±à¸šà¹à¸¥à¹‰à¸§
  DECLINED   // à¸›à¸à¸´à¹€à¸ªà¸˜
  EXPIRED    // à¸«à¸¡à¸”à¸­à¸²à¸¢à¸¸
}

enum OrganizationStatus {
  ACTIVE     // à¹ƒà¸Šà¹‰à¸‡à¸²à¸™à¹„à¸”à¹‰
  SUSPENDED  // à¸£à¸°à¸‡à¸±à¸š
  TRIAL      // à¸—à¸”à¸¥à¸­à¸‡à¹ƒà¸Šà¹‰
}

// ===== PRODUCT ENUMS =====
enum UnitType {
  PIECE      // à¸Šà¸´à¹‰à¸™
  BOX        // à¸à¸¥à¹ˆà¸­à¸‡
  BOTTLE     // à¸‚à¸§à¸”
  PACK       // à¹à¸žà¹‡à¸„
  STRIP      // à¹à¸œà¸‡
  TUBE       // à¸«à¸¥à¸­à¸”
  VIAL       // à¹„à¸§à¸­à¸±à¸¥
  AMPOULE    // à¹à¸­à¸¡à¸žà¸¹à¸¥
  KG         // à¸à¸´à¹‚à¸¥à¸à¸£à¸±à¸¡
  GRAM       // à¸à¸£à¸±à¸¡
  LITER      // à¸¥à¸´à¸•à¸£
  ML         // à¸¡à¸´à¸¥à¸¥à¸´à¸¥à¸´à¸•à¸£
  TABLET     // à¹€à¸¡à¹‡à¸”
  CAPSULE    // à¹à¸„à¸›à¸‹à¸¹à¸¥
  CUSTOM     // à¸à¸³à¸«à¸™à¸”à¹€à¸­à¸‡
}

enum ProductStatus {
  ACTIVE     // à¹ƒà¸Šà¹‰à¸‡à¸²à¸™à¹„à¸”à¹‰
  INACTIVE   // à¹„à¸¡à¹ˆà¹ƒà¸Šà¹‰à¸‡à¸²à¸™
  DISCONTINUED // à¹€à¸¥à¸´à¸à¸œà¸¥à¸´à¸•
  RESTRICTED   // à¸ˆà¸³à¸à¸±à¸”à¸à¸²à¸£à¹ƒà¸Šà¹‰
}

// ===== ROLE SYSTEM ENUMS =====
enum OrganizationRole {
  MEMBER  // à¸—à¸³à¸‡à¸²à¸™à¸—à¸±à¹ˆà¸§à¹„à¸› à¹€à¸šà¸´à¸ à¸ˆà¹ˆà¸²à¸¢ à¹à¸à¹‰à¸ªà¸•à¹‡à¸­à¸
  ADMIN   // Member + CRUD à¸ªà¸•à¹‡à¸­à¸à¸à¸²à¸£à¹Œà¸” + à¸ªà¸£à¹‰à¸²à¸‡ category + à¹€à¸Šà¸´à¸à¸œà¸¹à¹‰à¹ƒà¸Šà¹‰
  OWNER   // Admin + CRUD department + à¸ˆà¸±à¸”à¸à¸²à¸£à¸­à¸‡à¸„à¹Œà¸à¸£
}

// ===== STOCK TRANSACTION ENUMS =====
enum TransactionType {
  // à¸à¸²à¸£à¸£à¸±à¸šà¸ªà¸´à¸™à¸„à¹‰à¸²
  RECEIVE_PURCHASE     // à¸£à¸±à¸šà¸‹à¸·à¹‰à¸­
  RECEIVE_DONATION     // à¸£à¸±à¸šà¸šà¸£à¸´à¸ˆà¸²à¸„
  RECEIVE_RETURN       // à¸£à¸±à¸šà¸„à¸·à¸™
  RECEIVE_TRANSFER     // à¸£à¸±à¸šà¹‚à¸­à¸™
  
  // à¸à¸²à¸£à¸ˆà¹ˆà¸²à¸¢à¸ªà¸´à¸™à¸„à¹‰à¸²
  DISPENSE_SALE        // à¸ˆà¹ˆà¸²à¸¢à¸‚à¸²à¸¢
  DISPENSE_USE         // à¸ˆà¹ˆà¸²à¸¢à¹ƒà¸Šà¹‰à¸‡à¸²à¸™
  DISPENSE_TRANSFER    // à¸ˆà¹ˆà¸²à¸¢à¹‚à¸­à¸™
  DISPENSE_WASTE       // à¸—à¸´à¹‰à¸‡/à¹€à¸ªà¸µà¸¢à¸«à¸²à¸¢
  
  // à¸à¸²à¸£à¸›à¸£à¸±à¸šà¸›à¸£à¸¸à¸‡à¸ªà¸•à¹‡à¸­à¸
  ADJUST_INCREASE      // à¸›à¸£à¸±à¸šà¹€à¸žà¸´à¹ˆà¸¡
  ADJUST_DECREASE      // à¸›à¸£à¸±à¸šà¸¥à¸”
  ADJUST_COUNT         // à¸™à¸±à¸šà¸ªà¸•à¹‡à¸­à¸
  
  // à¸à¸²à¸£à¸ˆà¸­à¸‡
  RESERVE              // à¸ˆà¸­à¸‡à¸ªà¸´à¸™à¸„à¹‰à¸²
  UNRESERVE           // à¸¢à¸à¹€à¸¥à¸´à¸à¸à¸²à¸£à¸ˆà¸­à¸‡
}

// ===== TRANSFER SYSTEM ENUMS =====
enum TransferStatus {
  DRAFT      // à¸£à¹ˆà¸²à¸‡
  PENDING    // à¸£à¸­à¸à¸²à¸£à¸­à¸™à¸¸à¸¡à¸±à¸•à¸´
  APPROVED   // à¸­à¸™à¸¸à¸¡à¸±à¸•à¸´à¹à¸¥à¹‰à¸§
  PREPARING  // à¸à¸³à¸¥à¸±à¸‡à¹€à¸•à¸£à¸µà¸¢à¸¡
  READY      // à¸žà¸£à¹‰à¸­à¸¡à¸ªà¹ˆà¸‡
  SHIPPED    // à¸ˆà¸±à¸”à¸ªà¹ˆà¸‡à¹à¸¥à¹‰à¸§
  DELIVERED  // à¸ªà¹ˆà¸‡à¸–à¸¶à¸‡à¹à¸¥à¹‰à¸§
  RECEIVED   // à¸£à¸±à¸šà¹à¸¥à¹‰à¸§
  CANCELLED  // à¸¢à¸à¹€à¸¥à¸´à¸
  REJECTED   // à¸›à¸à¸´à¹€à¸ªà¸˜
}

enum TransferItemStatus {
  PENDING
  APPROVED  
  DISPATCHED
  RECEIVED
  CANCELLED
}

enum TransferType {
  INTERNAL   // à¹‚à¸­à¸™à¸ à¸²à¸¢à¹ƒà¸™à¸­à¸‡à¸„à¹Œà¸à¸£
  EXTERNAL   // à¹‚à¸­à¸™à¸ à¸²à¸¢à¸™à¸­à¸
  RETURN     // à¸„à¸·à¸™à¸ªà¸´à¸™à¸„à¹‰à¸²
  LOAN       // à¸¢à¸·à¸¡
  BORROW     // à¹ƒà¸«à¹‰à¸¢à¸·à¸¡
}

// ===== NOTIFICATION ENUMS =====
enum NotificationType {
  TRANSFER_REQUEST     // à¸„à¸³à¸‚à¸­à¹‚à¸­à¸™à¸ªà¸´à¸™à¸„à¹‰à¸²
  TRANSFER_APPROVED    // à¸­à¸™à¸¸à¸¡à¸±à¸•à¸´à¸à¸²à¸£à¹‚à¸­à¸™
  TRANSFER_REJECTED    // à¸›à¸à¸´à¹€à¸ªà¸˜à¸à¸²à¸£à¹‚à¸­à¸™
  STOCK_LOW           // à¸ªà¸•à¹‡à¸­à¸à¸•à¹ˆà¸³
  STOCK_EXPIRED       // à¸ªà¸´à¸™à¸„à¹‰à¸²à¸«à¸¡à¸”à¸­à¸²à¸¢à¸¸
  USER_INVITED        // à¹€à¸Šà¸´à¸à¸œà¸¹à¹‰à¹ƒà¸Šà¹‰
  ROLE_ASSIGNED       // à¸¡à¸­à¸šà¸«à¸¡à¸²à¸¢ Role
  SYSTEM_ALERT        // à¹à¸ˆà¹‰à¸‡à¹€à¸•à¸·à¸­à¸™à¸£à¸°à¸šà¸š
}

enum NotificationStatus {
  UNREAD     // à¸¢à¸±à¸‡à¹„à¸¡à¹ˆà¸­à¹ˆà¸²à¸™
  READ       // à¸­à¹ˆà¸²à¸™à¹à¸¥à¹‰à¸§
  ARCHIVED   // à¹€à¸à¹‡à¸šà¸–à¸²à¸§à¸£
}

// ===== AUDIT LOG ENUMS =====
enum AuditAction {
  CREATE
  UPDATE
  DELETE
  LOGIN
  LOGOUT
  APPROVE
  REJECT
  TRANSFER
  EXPORT
  IMPORT
}

// ===== UI ENUMS FOR COLORS & ICONS =====
enum ColorTheme {
  BLUE         // #3B82F6 - à¸ªà¸µà¸™à¹‰à¸³à¹€à¸‡à¸´à¸™
  GREEN        // #10B981 - à¸ªà¸µà¹€à¸‚à¸µà¸¢à¸§
  RED          // #EF4444 - à¸ªà¸µà¹à¸”à¸‡
  YELLOW       // #F59E0B - à¸ªà¸µà¹€à¸«à¸¥à¸·à¸­à¸‡
  PURPLE       // #8B5CF6 - à¸ªà¸µà¸¡à¹ˆà¸§à¸‡
  PINK         // #EC4899 - à¸ªà¸µà¸Šà¸¡à¸žà¸¹
  INDIGO       // #6366F1 - à¸ªà¸µà¸™à¹‰à¸³à¹€à¸‡à¸´à¸™à¹€à¸‚à¹‰à¸¡
  TEAL         // #14B8A6 - à¸ªà¸µà¹€à¸‚à¸µà¸¢à¸§à¸Ÿà¹‰à¸²
  ORANGE       // #F97316 - à¸ªà¸µà¸ªà¹‰à¸¡
  GRAY         // #6B7280 - à¸ªà¸µà¹€à¸—à¸²
  SLATE        // #475569 - à¸ªà¸µà¹€à¸—à¸²à¹€à¸‚à¹‰à¸¡
  EMERALD      // #059669 - à¸ªà¸µà¹€à¸‚à¸µà¸¢à¸§à¸¡à¸£à¸à¸•
}

enum IconType {
  // Department Icons
  BUILDING     // ðŸ¢ à¸ªà¸³à¸™à¸±à¸à¸‡à¸²à¸™
  HOSPITAL     // ðŸ¥ à¹‚à¸£à¸‡à¸žà¸¢à¸²à¸šà¸²à¸¥
  PHARMACY     // ðŸ’Š à¸£à¹‰à¸²à¸™à¸¢à¸²
  WAREHOUSE    // ðŸ“¦ à¸„à¸¥à¸±à¸‡à¸ªà¸´à¸™à¸„à¹‰à¸²
  LABORATORY   // ðŸ§ª à¸«à¹‰à¸­à¸‡à¹à¸¥à¹‡à¸š
  
  // Product Category Icons
  PILL         // ðŸ’Š à¸¢à¸²à¹€à¸¡à¹‡à¸”
  BOTTLE       // ðŸ¼ à¸¢à¸²à¸™à¹‰à¸³
  SYRINGE      // ðŸ’‰ à¸¢à¸²à¸‰à¸µà¸”
  BANDAGE      // ðŸ©¹ à¸­à¸¸à¸›à¸à¸£à¸“à¹Œà¸à¸²à¸£à¹à¸žà¸—à¸¢à¹Œ
  STETHOSCOPE  // ðŸ©º à¹€à¸„à¸£à¸·à¹ˆà¸­à¸‡à¸¡à¸·à¸­à¹à¸žà¸—à¸¢à¹Œ
  
  // Role Icons
  CROWN        // ðŸ‘‘ à¹€à¸ˆà¹‰à¸²à¸‚à¸­à¸‡
  SHIELD       // ðŸ›¡ï¸ à¸œà¸¹à¹‰à¸ˆà¸±à¸”à¸à¸²à¸£
  PERSON       // ðŸ‘¤ à¸žà¸™à¸±à¸à¸‡à¸²à¸™
  EYE          // ðŸ‘ï¸ à¸œà¸¹à¹‰à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸š
  GEAR         // âš™ï¸ à¸£à¸°à¸šà¸š
  
  // General Icons
  BOX          // ðŸ“¦ à¸à¸¥à¹ˆà¸­à¸‡
  FOLDER       // ðŸ“ à¹‚à¸Ÿà¸¥à¹€à¸”à¸­à¸£à¹Œ
  TAG          // ðŸ·ï¸ à¸›à¹‰à¸²à¸¢à¸à¸³à¸à¸±à¸š
  STAR         // â­ à¸”à¸²à¸§
  HEART        // â¤ï¸ à¸«à¸±à¸§à¹ƒà¸ˆ
  CIRCLE       // âšª à¸§à¸‡à¸à¸¥à¸¡
  SQUARE       // â¬œ à¸ªà¸µà¹ˆà¹€à¸«à¸¥à¸µà¹ˆà¸¢à¸¡
  TRIANGLE     // ðŸ”º à¸ªà¸²à¸¡à¹€à¸«à¸¥à¸µà¹ˆà¸¢à¸¡
}

// ==========================================
// USER SCHEMA - V1.0
// ==========================================

// prisma/schemas/user.prisma
// ===== USER MANAGEMENT SCHEMA - InvenStock V1.0 (CORRECTED) =====

model User {
  id          String     @id @default(cuid())
  email       String?             // âœ… Optional for notifications/recovery
  username    String     @unique  // âœ… Primary login credential
  password    String              // bcrypt hashed
  
  // Personal Information
  firstName   String
  lastName    String
  phone       String?
  
  // Account Status
  status      UserStatus @default(PENDING)
  isActive    Boolean    @default(true)
  emailVerified Boolean  @default(false)
  
  // Security
  lastLogin   DateTime?
  
  // Timestamps
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt
  
  // Relations
  organizationUsers     OrganizationUser[]
  sentInvitations       UserInvitation[] @relation("InviterUser")
  receivedInvitations   UserInvitation[] @relation("InviteeUser")
  stockTransactions     StockTransaction[]
  transfersRequested    Transfer[] @relation("RequesterUser")
  transfersApproved     Transfer[] @relation("ApproverUser") 
  transfersDispatched   Transfer[] @relation("DispatcherUser")
  transfersReceived     Transfer[] @relation("ReceiverUser")
  notifications         Notification[]
  auditLogs            AuditLog[]
  
  @@index([email])
  @@index([username])  // âœ… à¹€à¸žà¸´à¹ˆà¸¡ index à¸ªà¸³à¸«à¸£à¸±à¸š primary login
  @@index([status])
  @@index([isActive])
  @@map("users")
}

// User Invitations for joining organizations
model UserInvitation {
  id             String           @id @default(cuid())
  organizationId String
  inviterId      String
  inviteeId      String?          // null if inviting by username/email
  
  // âœ… à¸£à¸­à¸‡à¸£à¸±à¸šà¸—à¸±à¹‰à¸‡ email à¹à¸¥à¸° username invitation
  inviteeEmail   String?          // Can invite by email
  inviteeUsername String?         // Can invite by username
  
  // Invitation Details
  roleId         String?          // Role to assign upon acceptance
  message        String?          // Personal invitation message
  
  // Status
  status         InvitationStatus @default(PENDING)
  expiresAt      DateTime         // Invitation expiry
  
  // Response
  respondedAt    DateTime?
  response       String?          // Reason for decline
  
  // Timestamps
  createdAt      DateTime         @default(now())
  updatedAt      DateTime         @updatedAt
  
  // Relations
  organization   Organization     @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  inviter        User             @relation("InviterUser", fields: [inviterId], references: [id])
  invitee        User?            @relation("InviteeUser", fields: [inviteeId], references: [id])
  
  // âœ… à¸•à¹‰à¸­à¸‡à¸¡à¸µà¸­à¸¢à¹ˆà¸²à¸‡à¸™à¹‰à¸­à¸¢ 1 à¹ƒà¸™ 2: email à¸«à¸£à¸·à¸­ username
  // à¹à¸¥à¸° unique constraint à¹à¸¢à¸à¸à¸±à¸™
  @@unique([organizationId, inviteeEmail])
  @@unique([organizationId, inviteeUsername])
  @@index([status])
  @@index([expiresAt])
  @@map("user_invitations")
}

// ==========================================
// ORGANIZATION SCHEMA - V1.0
// ==========================================

// prisma/schemas/organization.prisma
// ===== MULTI-TENANT ORGANIZATION SCHEMA - InvenStock V1.0 =====

model Organization {
  id          String             @id @default(cuid())
  name        String
  slug        String             @unique // URL-friendly identifier
  description String?
  
  // Branding & Appearance
  logo        String?            // URL to logo
  primaryColor String?           // Hex color code
  
  // Contact Information
  email       String?
  phone       String?
  website     String?
  address     String?
  
  // Settings
  status      OrganizationStatus @default(ACTIVE)
  timezone    String             @default("Asia/Bangkok")
  currency    String             @default("THB")
  
  // Feature Settings
  allowDepartments    Boolean    @default(true)
  
  // Timestamps
  createdAt   DateTime           @default(now())
  updatedAt   DateTime           @updatedAt
  
  // Relations
  users               OrganizationUser[]
  departments         Department[]
  productCategories   ProductCategory[]
  productTypes        ProductType[]     // Added for custom product types
  productForms        ProductForm[]     // Added for custom product forms
  products            Product[]
  stocks              Stock[]
  stockTransactions   StockTransaction[] // ðŸ”¥ ADDED MISSING RELATION
  transfers           Transfer[]
  invitations         UserInvitation[]
  notifications       Notification[]
  settings            OrganizationSetting[]
  auditLogs          AuditLog[]
  
  @@index([slug])
  @@index([status])
  @@map("organizations")
}

// User-Organization Relationship (Many-to-Many)
model OrganizationUser {
  id             String       @id @default(cuid())
  organizationId String
  userId         String
  
  // Membership Details
  isOwner        Boolean      @default(false)
  joinedAt       DateTime     @default(now())
  lastActiveAt   DateTime?
  
  // Status
  isActive       Boolean      @default(true)
  
  // Relations
  organization   Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  user           User         @relation(fields: [userId], references: [id], onDelete: Cascade)
  roles          OrganizationRole @default(MEMBER)
  
  @@unique([organizationId, userId])
  @@index([isActive])
  @@map("organization_users")
}

// Hierarchical Departments
model Department {
  id             String       @id @default(cuid())
  organizationId String
  parentId       String?      // For hierarchical structure
  
  // Department Details
  name           String
  code           String       // Short code (e.g., "IT", "HR")
  description    String?
  color          ColorTheme?    // à¹à¸—à¸™ String?
  icon           IconType?      // à¹à¸—à¸™ String?
  
  // Settings
  isActive       Boolean      @default(true)
  
  // Audit Fields
  createdBy      String       // User who created
  updatedBy      String?      // User who last updated
  
  // Timestamps
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt
  
  // Relations
  organization   Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  parent         Department?  @relation("DepartmentHierarchy", fields: [parentId], references: [id])
  children       Department[] @relation("DepartmentHierarchy")
  stocks         Stock[]
  transfersFrom  Transfer[]   @relation("FromDepartment")
  transfersTo    Transfer[]   @relation("ToDepartment")
  
  @@unique([organizationId, code])
  @@index([parentId])
  @@index([isActive])
  @@map("departments")
}

// Organization Settings (Key-Value Store)
model OrganizationSetting {
  id             String       @id @default(cuid())
  organizationId String
  key            String       // Setting key (e.g., "stock.low_threshold")
  value          String       // JSON string value
  type           String       @default("string") // string, number, boolean, json
  
  // Metadata
  description    String?
  isEditable     Boolean      @default(true)
  
  // Audit Fields
  createdBy      String       // User who created
  updatedBy      String?      // User who last updated
  
  // Timestamps
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt
  
  // Relations
  organization   Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  
  @@unique([organizationId, key])
  @@index([key])
  @@map("organization_settings")
}

// ==========================================
// PRODUCT SCHEMA - V1.0
// ==========================================

// prisma/schemas/product.prisma
// ===== PRODUCT MANAGEMENT SCHEMA - InvenStock V1.0 =====

// Custom Product Categories per Organization
model ProductCategory {
  id             String       @id @default(cuid())
  organizationId String
  parentId       String?      // For hierarchical structure
  
  // Category Details
  name           String
  code           String?      // Category code
  description    String?
  color          ColorTheme?    // à¹à¸—à¸™ String?
  icon           IconType?      // à¹à¸—à¸™ String?
  
  // Settings
  isActive       Boolean      @default(true)
  sortOrder      Int          @default(0)
  
  // Timestamps
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt
  
  // Relations
  organization   Organization    @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  parent         ProductCategory? @relation("CategoryHierarchy", fields: [parentId], references: [id])
  children       ProductCategory[] @relation("CategoryHierarchy")
  products       Product[]
  
  @@unique([organizationId, name])
  @@index([parentId])
  @@index([sortOrder])
  @@map("product_categories")
}

// Custom Product Types per Organization
model ProductType {
  id             String       @id @default(cuid())
  organizationId String
  
  // Type Details
  name           String       // à¹€à¸Šà¹ˆà¸™ "à¸¢à¸²à¹€à¸¡à¹‡à¸”", "à¸¢à¸²à¸™à¹‰à¸³", "à¸­à¸¸à¸›à¸à¸£à¸“à¹Œà¸à¸²à¸£à¹à¸žà¸—à¸¢à¹Œ"
  code           String?      // à¸£à¸«à¸±à¸ªà¸›à¸£à¸°à¹€à¸ à¸—
  description    String?
  color          ColorTheme?    // à¹à¸—à¸™ String?
  icon           IconType?      // à¹à¸—à¸™ String?
  
  // Settings
  isActive       Boolean      @default(true)
  sortOrder      Int          @default(0)
  
  // Timestamps
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt
  
  // Relations
  organization   Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  products       Product[]
  
  @@unique([organizationId, name])
  @@index([isActive])
  @@map("product_types")
}

// Custom Product Forms per Organization  
model ProductForm {
  id             String       @id @default(cuid())
  organizationId String
  
  // Form Details
  name           String       // à¹€à¸Šà¹ˆà¸™ "à¹€à¸¡à¹‡à¸”", "à¹à¸„à¸›à¸‹à¸¹à¸¥", "à¸™à¹‰à¸³", "à¸„à¸£à¸µà¸¡"
  code           String?      // à¸£à¸«à¸±à¸ªà¸£à¸¹à¸›à¹à¸šà¸š
  description    String?
  
  // Settings
  isActive       Boolean      @default(true)
  sortOrder      Int          @default(0)
  
  // Timestamps
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt
  
  // Relations
  organization   Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  products       Product[]
  
  @@unique([organizationId, name])
  @@index([isActive])
  @@map("product_forms")
}

// Products with Custom Organization Fields
model Product {
  id             String          @id @default(cuid())
  organizationId String
  categoryId     String?         // à¸«à¸¡à¸§à¸”à¸«à¸¡à¸¹à¹ˆà¸ªà¸´à¸™à¸„à¹‰à¸²
  typeId         String?         // à¸›à¸£à¸°à¹€à¸ à¸—à¸ªà¸´à¸™à¸„à¹‰à¸² (custom per org)
  formId         String?         // à¸£à¸¹à¸›à¹à¸šà¸šà¸ªà¸´à¸™à¸„à¹‰à¸² (custom per org)
  
  // Product Identification - à¸•à¸²à¸¡à¸„à¸§à¸²à¸¡à¸•à¹‰à¸­à¸‡à¸à¸²à¸£
  orgProductCode String          // à¸£à¸«à¸±à¸ªà¸ªà¸´à¸™à¸„à¹‰à¸²à¸‚à¸­à¸‡à¸­à¸‡à¸„à¹Œà¸à¸£ (required)
  barcode        String?         // Barcode/QR code
  
  // Product Details - à¸•à¸²à¸¡à¸„à¸§à¸²à¸¡à¸•à¹‰à¸­à¸‡à¸à¸²à¸£
  name           String          // à¸Šà¸·à¹ˆà¸­à¸ªà¸´à¸™à¸„à¹‰à¸² (required)
  description    String?         // à¸£à¸²à¸¢à¸¥à¸°à¹€à¸­à¸µà¸¢à¸”à¸ªà¸´à¸™à¸„à¹‰à¸² (optional)
  supplier       String?         // à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¸ˆà¸±à¸”à¸ˆà¸³à¸«à¸™à¹ˆà¸²à¸¢ (optional)
  
  // Product Specifications - à¸•à¸²à¸¡à¸„à¸§à¸²à¸¡à¸•à¹‰à¸­à¸‡à¸à¸²à¸£
  strength       String?         // à¸„à¸§à¸²à¸¡à¹à¸£à¸‡à¸ªà¸´à¸™à¸„à¹‰à¸² (à¹€à¸Šà¹ˆà¸™ "500mg")
  volume         String?         // à¸›à¸£à¸´à¸¡à¸²à¸•à¸£à¸ªà¸´à¸™à¸„à¹‰à¸² (à¹€à¸Šà¹ˆà¸™ "100ml")
  qtyPerBox      Int             @default(1) // à¸›à¸£à¸´à¸¡à¸²à¸“à¸•à¹ˆà¸­à¸à¸¥à¹ˆà¸­à¸‡ (required, default 1)
  unit           UnitType        @default(PIECE)
  
  // Inventory Settings
  minStockLevel  Int             @default(0)     // Minimum stock alert
  maxStockLevel  Int?            // Maximum stock limit
  
  // Status & Settings - à¸•à¸²à¸¡à¸„à¸§à¸²à¸¡à¸•à¹‰à¸­à¸‡à¸à¸²à¸£
  isActive       Boolean         @default(true)  // à¸ªà¸–à¸²à¸™à¸°à¸à¸²à¸£à¹ƒà¸Šà¹‰à¸‡à¸²à¸™ (required)
  
  // Audit Fields
  createdBy      String          // User who created
  updatedBy      String?         // User who last updated
  
  // Timestamps
  createdAt      DateTime        @default(now())
  updatedAt      DateTime        @updatedAt
  
  // Relations
  organization   Organization    @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  category       ProductCategory? @relation(fields: [categoryId], references: [id])
  productType    ProductType?    @relation(fields: [typeId], references: [id])
  productForm    ProductForm?    @relation(fields: [formId], references: [id])
  batches        ProductBatch[]
  stocks         Stock[]
  transferItems  TransferItem[]
  
  @@unique([organizationId, orgProductCode]) // à¸­à¸‡à¸„à¹Œà¸à¸£à¸•à¹‰à¸­à¸‡à¸¡à¸µà¸£à¸«à¸±à¸ªà¸ªà¸´à¸™à¸„à¹‰à¸²à¹„à¸¡à¹ˆà¸‹à¹‰à¸³
  @@index([isActive])
  @@index([categoryId])
  @@index([typeId])
  @@index([formId])
  @@index([barcode])
  @@map("products")
}

// Product Batches for Lot/Expiry/Price Tracking - à¸•à¸²à¸¡à¸„à¸§à¸²à¸¡à¸•à¹‰à¸­à¸‡à¸à¸²à¸£
model ProductBatch {
  id             String       @id @default(cuid())
  productId      String
  
  // Batch Details - à¸•à¸²à¸¡à¸„à¸§à¸²à¸¡à¸•à¹‰à¸­à¸‡à¸à¸²à¸£
  batchNumber    String       // Lot/Batch number (required)
  expiryDate     DateTime?    // à¸§à¸±à¸™à¸«à¸¡à¸”à¸­à¸²à¸¢à¸¸ (optional)
  
  // Pricing - à¸•à¸²à¸¡à¸„à¸§à¸²à¸¡à¸•à¹‰à¸­à¸‡à¸à¸²à¸£ (à¹à¸•à¹ˆà¸¥à¸° lot à¸£à¸²à¸„à¸²à¸•à¹ˆà¸²à¸‡à¸à¸±à¸™)
  costPrice      Float        @default(0) // à¸£à¸²à¸„à¸²à¸•à¹‰à¸™à¸—à¸¸à¸™à¸•à¹ˆà¸­à¸à¸¥à¹ˆà¸­à¸‡ (required)
  sellingPrice   Float        @default(0) // à¸£à¸²à¸„à¸²à¸‚à¸²à¸¢à¸•à¹ˆà¸­à¸à¸¥à¹ˆà¸­à¸‡ (required)
  
  // Quantity Tracking
  currentQty     Int          @default(0) // à¸ˆà¸³à¸™à¸§à¸™à¸›à¸±à¸ˆà¸ˆà¸¸à¸šà¸±à¸™
  
  // Status
  isActive       Boolean      @default(true)
  
  // Audit Fields
  createdBy      String       // User who created
  updatedBy      String?      // User who last updated
  
  // Timestamps
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt
  
  // Relations
  product        Product      @relation(fields: [productId], references: [id], onDelete: Cascade)
  stockTransactions StockTransaction[]
  transferItems  TransferItem[]
  
  @@unique([productId, batchNumber]) // à¸ªà¸´à¸™à¸„à¹‰à¸²à¹à¸•à¹ˆà¸¥à¸°à¸•à¸±à¸§à¸•à¹‰à¸­à¸‡à¸¡à¸µ batch number à¹„à¸¡à¹ˆà¸‹à¹‰à¸³
  @@index([expiryDate])
  @@index([isActive])
  @@index([costPrice])
  @@map("product_batches")
}

// ==========================================
// STOCK SCHEMA - V1.0
// ==========================================

// prisma/schemas/stock.prisma
// ===== STOCK MANAGEMENT SCHEMA - InvenStock V1.0 =====

// Stock Tracking per Department
model Stock {
  id             String       @id @default(cuid())
  organizationId String
  productId      String
  departmentId   String?      // null = organization-wide stock
  
  // Stock Quantities
  totalQuantity  Int          @default(0)  // Total available
  reservedQty    Int          @default(0)  // Reserved for transfers
  
  // Stock Levels
  minStockLevel  Int          @default(0)  // Department-specific minimum
  maxStockLevel  Int?         // Department-specific maximum
  reorderPoint   Int          @default(0)  // Auto-reorder trigger
  reorderQty     Int?         // Auto-reorder quantity
  
  // Audit Fields
  createdBy      String       // User who created
  updatedBy      String?      // User who last updated
  
  // Timestamps
  lastCountDate  DateTime?    // Last physical count
  lastMovement   DateTime?    // Last stock movement
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt
  
  // Relations
  organization   Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  product        Product      @relation(fields: [productId], references: [id], onDelete: Cascade)
  department     Department?  @relation(fields: [departmentId], references: [id])
  transactions   StockTransaction[]
  
  @@unique([organizationId, productId, departmentId])
  @@index([minStockLevel])
  @@index([totalQuantity])
  @@map("stocks")
}

// Stock Movement Transactions
model StockTransaction {
  id             String          @id @default(cuid())
  organizationId String
  stockId        String
  batchId        String?         // Link to specific batch
  userId         String
  
  // Transaction Details
  type           TransactionType
  reference      String?         // Reference number/document
  note           String?         // Transaction note
  
  // Quantities
  quantity       Int             // Change in quantity (+/-)
  beforeQty      Int             // Stock before transaction
  afterQty       Int             // Stock after transaction
  
  // Financial
  unitCost       Float           @default(0)
  totalCost      Float           @default(0)
  
  // Related Records
  transferId     String?         // If part of transfer
  transferItemId String?         // Specific transfer item
  
  // Location
  fromLocation   String?         // Source location
  toLocation     String?         // Destination location
  
  // Approval
  approvedBy     String?         // Approver user ID
  approvedAt     DateTime?       // Approval timestamp
  
  // Timestamps
  transactionDate DateTime       @default(now())
  createdAt      DateTime        @default(now())
  
  // Relations
  organization   Organization    @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  stock          Stock           @relation(fields: [stockId], references: [id], onDelete: Cascade)
  batch          ProductBatch?   @relation(fields: [batchId], references: [id])
  user           User            @relation(fields: [userId], references: [id])
  transfer       Transfer?       @relation(fields: [transferId], references: [id])
  
  @@index([type])
  @@index([transactionDate])
  @@index([transferId])
  @@index([stockId])
  @@map("stock_transactions")
}

// ==========================================
// TRANSFER SCHEMA - V1.0
// ==========================================

// prisma/schemas/transfer.prisma
// ===== TRANSFER SYSTEM SCHEMA - InvenStock V1.0 =====

// Transfer Requests between Departments/Organizations
model Transfer {
  id                String         @id @default(cuid())
  organizationId    String
  transferNumber    String         // Auto-generated transfer number
  
  // Transfer Type & Direction
  type              TransferType   @default(INTERNAL)
  
  // Source & Destination
  fromDeptId        String?        // Source department
  toDeptId          String?        // Destination department
  fromOrgId         String?        // For external transfers
  toOrgId           String?        // For external transfers
  
  // Transfer Details
  title             String         // Transfer title/purpose
  description       String?        // Detailed description
  priority          String         @default("NORMAL") // HIGH, NORMAL, LOW
  
  // User Workflow
  requesterId       String         // Who requested
  approverId        String?        // Who approved
  dispatcherId      String?        // Who prepared/dispatched
  receiverId        String?        // Who received
  
  // Status & Workflow
  status            TransferStatus @default(DRAFT)
  
  // Quantities & Values
  totalItems        Int            @default(0)
  totalQuantity     Int            @default(0)
  totalValue        Float          @default(0)
  
  // Dates & Times
  requestedDate     DateTime       @default(now())
  requiredDate      DateTime?      // When needed
  approvedDate      DateTime?
  dispatchedDate    DateTime?
  deliveredDate     DateTime?
  receivedDate      DateTime?
  
  // Shipping Info
  shippingMethod    String?        // Delivery method
  trackingNumber    String?        // Tracking reference
  carrier           String?        // Shipping carrier
  
  // Audit Fields
  createdBy         String         // User who created
  updatedBy         String?        // User who last updated
  
  // Timestamps
  createdAt         DateTime       @default(now())
  updatedAt         DateTime       @updatedAt
  
  // Relations
  organization      Organization   @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  fromDept          Department?    @relation("FromDepartment", fields: [fromDeptId], references: [id])
  toDept            Department?    @relation("ToDepartment", fields: [toDeptId], references: [id])
  requester         User           @relation("RequesterUser", fields: [requesterId], references: [id])
  approver          User?          @relation("ApproverUser", fields: [approverId], references: [id])
  dispatcher        User?          @relation("DispatcherUser", fields: [dispatcherId], references: [id])
  receiver          User?          @relation("ReceiverUser", fields: [receiverId], references: [id])
  items             TransferItem[]
  stockTransactions StockTransaction[]
  
  @@unique([organizationId, transferNumber])
  @@index([status])
  @@index([type])
  @@index([requestedDate])
  @@index([fromDeptId])
  @@index([toDeptId])
  @@map("transfers")
}

// Transfer Items - Products in each transfer
model TransferItem {
  id              String       @id @default(cuid())
  transferId      String
  productId       String
  batchId         String?      // Specific batch if tracked
  
  // Quantities at different stages
  requestedQty    Int          // Initially requested
  approvedQty     Int?         // Approved quantity
  dispatchedQty   Int?         // Actually dispatched
  receivedQty     Int?         // Actually received
  
  // Batch Information
  lotNumber       String?      // Lot/batch number
  expiryDate      DateTime?    // Expiry date
  
  // Pricing (from batch)
  unitPrice       Float        @default(0)
  totalValue      Float        @default(0)
  
  // Item Status
  status          TransferItemStatus @default(PENDING)
  
  // Audit Fields
  createdBy       String       // User who created
  updatedBy       String?      // User who last updated
  
  // Timestamps
  createdAt       DateTime     @default(now())
  updatedAt       DateTime     @updatedAt
  
  // Relations
  transfer        Transfer     @relation(fields: [transferId], references: [id], onDelete: Cascade)
  product         Product      @relation(fields: [productId], references: [id])
  batch           ProductBatch? @relation(fields: [batchId], references: [id])
  
  @@index([transferId])
  @@index([productId])
  @@index([status])
  @@map("transfer_items")
}

// ==========================================
// NOTIFICATION SCHEMA - V1.0
// ==========================================

// prisma/schemas/notification.prisma
// ===== NOTIFICATION SYSTEM SCHEMA - InvenStock V1.0 =====

// Real-time Notifications
model Notification {
  id             String             @id @default(cuid())
  organizationId String
  userId         String
  
  // Notification Details
  type           NotificationType
  title          String             // Notification title
  message        String             // Notification content
  
  // Related Records
  relatedId      String?            // ID of related record (transfer, product, etc.)
  relatedType    String?            // Type of related record
  relatedData    String?            // JSON data for the notification
  
  // Action
  actionUrl      String?            // URL to navigate when clicked
  actionLabel    String?            // Button text for action
  
  // Status
  status         NotificationStatus @default(UNREAD)
  priority       String             @default("NORMAL") // HIGH, NORMAL, LOW
  
  // Scheduling
  scheduledFor   DateTime?          // For scheduled notifications
  expiresAt      DateTime?          // Auto-archive date
  
  // Timestamps
  readAt         DateTime?          // When marked as read
  archivedAt     DateTime?          // When archived
  createdAt      DateTime           @default(now())
  
  // Relations
  organization   Organization       @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  user           User               @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  @@index([userId, status])
  @@index([type])
  @@index([createdAt])
  @@index([organizationId])
  @@map("notifications")
}

// ==========================================
// AUDIT SCHEMA - V1.0
// ==========================================

// prisma/schemas/audit.prisma
// ===== STREAMLINED AUDIT SYSTEM - InvenStock V2.0 =====

// Single Audit Model - Hybrid Approach
model AuditLog {
  id             String @id @default(cuid())
  organizationId String
  userId         String?
  
  // Action Tracking (Dot Notation)
  action         String      // "products.create", "transfers.approve", "users.login"
  resourceId     String?     // ID of affected record
  
  // Smart Payload Storage
  payload        Json?       // Context-aware data based on action type
  
  // Timestamp
  createdAt      DateTime @default(now())
  
  // Relations
  organization   Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  user           User? @relation(fields: [userId], references: [id])
  
  // Optimized Indexes
  @@index([organizationId, createdAt])
  @@index([action])
  @@index([resourceId])
  @@map("audit_logs")
}

// ===== PAYLOAD STANDARDS BY ACTION TYPE =====
/*
ðŸ” AUTHENTICATION ACTIONS
"users.login" -> { "ip": "x.x.x.x", "success": true }
"users.logout" -> { "sessionDuration": 3600 }
"users.failed_login" -> { "ip": "x.x.x.x", "reason": "invalid_password" }

ðŸ“¦ PRODUCT ACTIONS  
"products.create" -> { "name": "Paracetamol", "code": "PRD001", "category": "Pain Relief" }
"products.update" -> { "changes": {"price": [100, 150], "name": ["old", "new"]} }
"products.delete" -> { "name": "Paracetamol", "code": "PRD001", "hasStock": false }

ðŸ“Š STOCK ACTIONS
"stock.adjust" -> { "product": "Paracetamol", "from": 100, "to": 150, "reason": "count_correction" }
"stock.receive" -> { "product": "Paracetamol", "qty": 50, "supplier": "ABC Pharma" }
"stock.dispense" -> { "product": "Paracetamol", "qty": 10, "department": "ICU" }

ðŸšš TRANSFER ACTIONS
"transfers.create" -> { "fromDept": "Pharmacy", "toDept": "ICU", "itemCount": 5 }
"transfers.approve" -> { "transferNumber": "TRF-001", "totalValue": 15000 }
"transfers.reject" -> { "transferNumber": "TRF-001", "reason": "insufficient_stock" }
"transfers.receive" -> { "transferNumber": "TRF-001", "receivedItems": 5 }

ðŸ‘¥ USER MANAGEMENT
"users.invite" -> { "email": "user@example.com", "role": "Pharmacist" }
"users.role_change" -> { "from": "Staff", "to": "Manager", "reason": "promotion" }
"users.deactivate" -> { "reason": "resignation" }

âš™ï¸ SYSTEM ACTIONS
"system.backup" -> { "tables": ["products", "stocks"], "size": "15MB" }
"system.settings_update" -> { "key": "low_stock_threshold", "from": 10, "to": 5 }
"system.bulk_import" -> { "type": "products", "count": 150, "source": "excel" }
*/

// ===== TYPESCRIPT HELPER TYPES =====
/*
// Action definitions
type AuditAction = 
  | `users.${UserAction}`
  | `products.${ProductAction}` 
  | `stock.${StockAction}`
  | `transfers.${TransferAction}`
  | `system.${SystemAction}`;

type UserAction = 'login' | 'logout' | 'failed_login' | 'invite' | 'role_change' | 'deactivate';
type ProductAction = 'create' | 'update' | 'delete' | 'bulk_import';
type StockAction = 'adjust' | 'receive' | 'dispense' | 'count' | 'reserve';
type TransferAction = 'create' | 'approve' | 'reject' | 'dispatch' | 'receive' | 'cancel';
type SystemAction = 'backup' | 'settings_update' | 'bulk_import' | 'cleanup';

// Payload types for type safety
interface AuditPayload {
  'users.login': { ip: string; success: boolean; userAgent?: string };
  'products.create': { name: string; code: string; category?: string };
  'stock.adjust': { product: string; from: number; to: number; reason: string };
  'transfers.approve': { transferNumber: string; totalValue: number; itemCount: number };
  // ... add more as needed
}
*/
